<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="static/images/logo2.png">
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">

    <script>
    if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark-mode');
    }
    </script>


    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <title>{{ name }}</title>

    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }
        tr:nth-child(even) {
            background-color: #f5f5f5;
        }

        

        .horizontal-list {
            display: flex;
            flex-wrap: wrap;
            list-style-type: none;
            padding: 0;
        }

        .horizontal-list li {
            margin-right: 15px;
            border-right: 1px solid #ccc;
            padding-right: 10px;
        }

        .horizontal-list li:last-child {
            border-right: none;
        }

        .action-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: white;
            border: 2px solid #888;
            z-index: 9999;
            padding: 20px;
            overflow: auto;
        }

        #monaco-rdf-editor {
            height: 600px;
            width: 100%;
            border: 1px solid #ccc;
            margin-top: 10px;
        }


    </style>
</head>

<body>

    <div class="topnav">
        <a href="/AGAS" class="logo-link">
            <img src="{{ url_for('static', filename='images/logo2.png') }}" alt="Logo" class="logo-btn">
        </a>
        <a href="/">Home</a>
        <a href="/home">Extra</a>
        <a href="/resultsBQ">Results</a>
        <a href="/versions">Versions</a>
        <a href="/about">About</a>
        <a href="/contacts">Contact</a>
        <a id="theme-toggle">üåô</a>
        {% if session.logged_in %}
            <a href="/logout">Logout</a>
        {% else %}
            <a href="/login">Login</a>
        {% endif %}
        <div class="search-container">
            <form action="{{ url_for('search') }}" method="get" autocomplete="off">
                <input id="search-input" type="text" placeholder="Search.." name="query" oninput="autocompleteSearch(this.value)">
                <div id="autocomplete-box" class="autocomplete-items"></div>
                <button class="btn" type="submit"> üîç </button>
            </form>
        </div>
    </div>

    <div class="topnav">
    <div style="display: flex">
        <ul>
            {% if specific_pages == "STARS" %}
                <li style="display:flex">
                    <button class="star-btn" data-type="individual" data-name="{{ name }}">‚òÜ</button>
                </li>
            {% endif %}
        </ul>

        {% if data["Name"] %}
            <h1>{{ name }} </h1>
            <h2>- {{ data["Name"][0][0] }}</h2>
        {% else %}
            <h1>{{ name }}</h1>
        {% endif %}

    </div>  

    <h2>Details</h2>

    
    {% if session.logged_in %}
        <div class="action-bar">
        <button class="btn" style="margin:10px; padding: 15px;" onclick="showAllCards()">Show All</button>
        
        <a class="btn" style="margin:10px" href="{{ url_for('edit_individual', name=name) }}">Edit</a>
        
        {% if u_type == "EXP" %}
            <button class="btn" style="margin:10px; padding: 15px;" onclick="openEditor()">Edit Raw</button>
        {% endif %}

        <form action="{{ url_for('delete_individual') }}" method="post" onsubmit="return confirm('Are you sure you want to delete {{ name }}?');">
            <input type="hidden" name="name" value="{{ name }}">
            <button class="btn" style="margin:10px; padding: 15px;" type="submit">Delete</button>
        </form>
        </div>

        <div class="editVSC" id="editor-modal">
            <h2>Edit Source Code</h2>
            <div id="monaco-rdf-editor"></div>
            <br>
            <button onclick="saveRDF('{{ name }}')">Save</button>
            <button onclick="closeEditor()">Close</button>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js"></script>
        <script>
            let editor;

            function openEditor() {
                const modal = document.getElementById("editor-modal");
                modal.style.display = "block";

                if (document.body.classList.contains('dark-mode')) {
                    modal.style.background = "#2a2a2a";
                    modal.style.color = "#e0e0e0";
                } else {
                    modal.style.background = "white";
                    modal.style.color = "black";
                }

                require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs' }});
                require(["vs/editor/editor.main"], function () {
                    fetch(`/get_individual_code?name={{ name }}`)
                        .then(res => res.text())
                        .then(code => {
                            // 1. Register the language
                            monaco.languages.register({ id: 'customTurtle' });

                            // 2. Define syntax rules
                            monaco.languages.setMonarchTokensProvider('customTurtle', {
                                defaultToken: 'invalid',
                                tokenizer: {
                                    root: [
                                        [/##.*/, 'comment.darker'],
                                        [/#\S+/, 'notcomment'],
                                        [/#\s+.*/, 'comment'],
                                        [/prefix/, 'keyword'],
                                        [/<[^>]*>/, 'constant.uri'],
                                        [/\brdf:[\w\-]+/, 'rdf'],
                                        [/\brdfs:[\w\-]+/, 'rdfs'],
                                        [/\bowl:[\w\-]+/, 'owl'],
                                        [/\"([^"\\]|\\.)*\"/, 'string'],
                                        [/\./, 'delimiter'],
                                        [/;/, 'delimiter'],
                                        [/\b[a-zA-Z_][\w\-]*\b/, 'identifier']
                                    ]
                                }
                            });

                            // 3. Define the theme with proper colors structure
                            monaco.editor.defineTheme('customDark', {
                                base: 'vs-dark',
                                inherit: true,
                                rules: [
                                    { token: 'comment', foreground: '888888', fontStyle: 'italic' },
                                    { token: 'notcomment', foreground: 'C586C0', fontStyle: 'italic' },
                                    { token: 'comment.darker', foreground: '555555', fontStyle: 'italic' },
                                    { token: 'keyword', foreground: '569CD6', fontStyle: 'bold' },
                                    { token: 'rdf', foreground: 'C586C0' },
                                    { token: 'rdfs', foreground: '9CDCFE' },
                                    { token: 'owl', foreground: 'D7BA7D' },
                                    { token: 'constant.uri', foreground: '4EC9B0' },
                                    { token: 'string', foreground: 'CE9178' },
                                    { token: 'delimiter', foreground: 'CCCCCC' },
                                    { token: 'identifier', foreground: 'DDDDDD' }
                                ],
                                colors: {
                                    'editor.foreground': '#CCCCCC',
                                    'editor.background': '#1E1E1E'
                                }
                            });
                            
                            monaco.editor.defineTheme('customLight', {
                                base: 'vs',
                                inherit: true,
                                rules: [
                                    { token: 'comment', foreground: '008000', fontStyle: 'italic' },
                                    { token: 'comment.darker', foreground: '555555', fontStyle: 'italic' },
                                    { token: 'keyword', foreground: '0000FF', fontStyle: 'bold' },
                                    { token: 'rdf', foreground: '800080' },
                                    { token: 'rdfs', foreground: '0070C1' },
                                    { token: 'owl', foreground: 'B8860B' },
                                    { token: 'constant.uri', foreground: '008080' },
                                    { token: 'string', foreground: 'A31515' },
                                    { token: 'delimiter', foreground: '000000' },
                                    { token: 'identifier', foreground: '000000' }
                                ],
                                colors: {
                                    'editor.foreground': '#000000',
                                    'editor.background': '#FFFFFF'
                                }
                            });

                            // 4. Create the editor with theme detection
                            const currentTheme = document.body.classList.contains('dark-mode') ? 'customDark' : 'customLight';
                            
                            editor = monaco.editor.create(document.getElementById('monaco-rdf-editor'), {
                                value: code,
                                language: 'customTurtle',
                                theme: currentTheme,
                                automaticLayout: true,
                                wordWrap: 'on'
                            });

                        });
                });
            }

            function closeEditor() {
                document.getElementById("editor-modal").style.display = "none";
                if (editor) {
                    editor.dispose();
                }
            }

            function saveRDF(name) {
                const content = editor.getValue();
                fetch("/save_individual_code", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ name: name, content: content })
                })
                .then(res => res.json())
                .then(response => {
                    if (response.success) {
                        alert("Saved successfully!");
                        location.reload();
                    } else {
                        alert("Error: " + response.error);
                    }
                });
            }
        </script>

    {% elif not session.logged_in %}
        <div class="sessionLIO">
            <strong>Read-only mode:</strong> Login to enable editing features.
        </div>
    {% endif %}
    </div>


    <!-- Property Cards -->
<div class="text-cards">
    {% if priority != "NONE" or priority != "None"%}
        {% for prio in priority %}
            {% for prop, values in data.items() %}
                {% if prop == prio and prop != "Story" and prop not in make_pretty %}
                    <div class="card">
                        <button class="ex" onclick="toggleCard(this)">x</button>
                        <h3>{{ prop }}{% if values|length > 3 %} ({{ values|length }}){% endif %}</h3>
                        {% for label, is_link in values %}
                            <div class="{% if loop.index > 3 %}hidden{% endif %}">
                                {% if is_link == True %}
                                    {% set lower_label = label.lower() %}
                                    {% if 'wikipedia.org/wiki/' in label and '#/media/File:' in label %}
                                        {% set filename = label.split('#/media/File:')[-1] %}
                                        <div class="image-container">
                                            <a href="https://commons.wikimedia.org/wiki/File:{{ filename }}" target="_blank">
                                                <img src="https://commons.wikimedia.org/wiki/Special:FilePath/{{ filename }}" alt="Image" style="max-width: 300px; height: auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                            </a>
                                        </div>
                                    {% elif lower_label.endswith('.jpg') or lower_label.endswith('.jpeg') or lower_label.endswith('.png') or lower_label.endswith('.gif') or lower_label.endswith('.svg') %}
                                        <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                                    {% else %}
                                        {% if prop in properties and properties != [] %}
                                            <a href="{{ url_for('show_property', prop=prop, value=label) }}">{{ label }}</a>
                                        {% elif 'has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+prop, value=label) }}">{{ label }}</a>
                                        {% elif 'Has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+prop, value=label) }}">{{ label }}</a>
                                        {% else %}
                                            <a href="{{ url_for('show_deity', name=label) }}">{{ label }}</a>
                                        {% endif %}
                                    {% endif %}
                                {% elif is_link == "module" %}
                                    <ul>
                                    {% for subkey, (subvalue, is_uri) in label.items() %}
                                        <li><strong>{{ subkey }}:</strong>
                                        {% if is_uri %}
                                            {% if prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'has'+prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'Has'+prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            
                                            {% elif subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'has'+subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'Has'+subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>

                                            
                                            {% else %}
                                                <a href="{{ url_for('show_deity', name=subvalue) }}">{{ subvalue }}</a>
                                            {% endif %}
                                        {% else %}
                                            {% if prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'has'+prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'Has'+prop in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'has'+subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% elif 'Has'+subkey in properties and properties!=[] %}
                                                    <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                            {% else %}
                                                {{ subvalue }}
                                            {% endif %}
                                        {% endif %}
                                        </li>
                                    {% endfor %}
                                    </ul>

                                {% else %}
                                    {% if '.png' in label or '.jpg' in label or '.jpeg' in label or '.gif' in label or '.svg' in label  %}
                                        <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                                    {% elif '/owl#NamedIndividual' not in label %}
                                        {{ label }}
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% endfor %}
                        {% if values|length > 3 %}
                            <button class="btn" onclick="showMore(this)">‚Äì see more ‚Äì</button>
                        
                        {% endif %}
                    </div>

                {% endif %}
            {% endfor %}
        {% endfor %}
    {% endif %}

    
    {% for prop, values in data.items() %}
        {% if prop not in priority and prop != "Story" and prop not in make_pretty %}
            <div class="card">
                <button class="ex" onclick="toggleCard(this)">x</button>
                <h3>{{ prop }}{% if values|length > 3 %} ({{ values|length }}){% endif %}</h3>
                {% for label, is_link in values %}
                    <div class="{% if loop.index > 3 %}hidden{% endif %}">
                        {% if is_link == True %}
                            {% set lower_label = label.lower() %}
                            {% if 'wikipedia.org/wiki/' in label and '#/media/File:' in label %}
                                {% set filename = label.split('#/media/File:')[-1] %}
                                <div class="image-container">
                                    <a href="https://commons.wikimedia.org/wiki/File:{{ filename }}" target="_blank">
                                        <img src="https://commons.wikimedia.org/wiki/Special:FilePath/{{ filename }}" alt="Image">
                                    </a>
                                </div>
                            {% elif lower_label.endswith('.jpg') or lower_label.endswith('.jpeg') or lower_label.endswith('.png') or lower_label.endswith('.gif') or lower_label.endswith('.svg') %}
                                <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                            {% else %}
                                {% if prop in properties and properties != [] %}
                                    <a href="{{ url_for('show_property', prop=prop, value=label) }}">{{ label }}</a>
                                {% elif 'has'+prop in properties and properties!=[] %}
                                    <a href="{{ url_for('show_property', prop='has'+prop, value=label) }}">{{ label }}</a>
                                {% elif 'Has'+prop in properties and properties!=[] %}
                                    <a href="{{ url_for('show_property', prop='Has'+prop, value=label) }}">{{ label }}</a>
                                {% else %}
                                    <a href="{{ url_for('show_deity', name=label) }}">{{ label }}</a>
                                {% endif %}
                            {% endif %}
                        {% elif is_link == "module" %}
                            <ul>
                            {% for subkey, (subvalue, is_uri) in label.items() %}
                                <li><strong>{{ subkey }}:</strong>
                                {% if is_uri %}
                                    {% if prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    
                                    {% elif subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>

                                    
                                    {% else %}
                                        <a href="{{ url_for('show_deity', name=subvalue) }}">{{ subvalue }}</a>
                                    {% endif %}
                                {% else %}
                                    {% if prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% else %}
                                        {{ subvalue }}
                                    {% endif %}
                                {% endif %}
                                </li>
                            {% endfor %}
                            </ul>

                        {% else %}
                            {% if '.png' in label or '.jpg' in label or '.jpeg' in label or '.gif' in label or '.svg' in label  %}
                                        <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                            {% elif '/owl#NamedIndividual' not in label and '/owl#Class' not in label %}
                                {{ label }}
                            {% else %}
                                {% if '/owl#Class' not in label %}
                                    {{ label.split("#")[-1] }}
                                {% endif %}    
                            {% endif %}
                        {% endif %}
                    </div>
                {% endfor %}
                {% if values|length > 3 %}
                    <button class="btn" onclick="showMore(this)">‚Äì see more ‚Äì</button>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}

    <!-- Pretty Content -->
    {% set delay = 0 %}
    {% set filled_content = [] %}
    {% set card_limit = 1 %}
    {% set shown_props = 0 %}
    {% for prop in make_pretty %}
        {% if prop != 'Story' and prop in data and shown_props < card_limit %}
            {% set _ = filled_content.append((prop, data[prop])) %}
            {% set shown_props = shown_props + 1 %}
        {% endif %}
    {% endfor %}
    {% if filled_content %}
        <div class="card" style="--delay: {{ delay }}s;">
            <button class="ex" onclick="toggleCard(this)">x</button>
            {% for prop, values in filled_content %}
                <h3>{{ prop }}</h3>
                {% for label, is_link in values %}
                    <div class="{% if loop.index > 3 %}hidden{% endif %}">
                        {% if is_link == True %}
                            {% set lower_label = label.lower() %}
                            {% if 'wikipedia.org/wiki/' in label and '#/media/File:' in label %}
                                {% set filename = label.split('#/media/File:')[-1] %}
                                <div class="image-container">
                                    <a href="https://commons.wikimedia.org/wiki/File:{{ filename }}" target="_blank">
                                        <img src="https://commons.wikimedia.org/wiki/Special:FilePath/{{ filename }}" alt="Image">
                                    </a>
                                </div>
                            {% elif lower_label.endswith('.jpg') or lower_label.endswith('.jpeg') or lower_label.endswith('.png') or lower_label.endswith('.gif') or lower_label.endswith('.svg') %}
                                <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                            {% else %}
                                {% if prop in properties and properties != [] %}
                                    <a href="{{ url_for('show_property', prop=prop, value=label) }}">{{ label }}</a>
                                {% elif 'has'+prop in properties and properties!=[] %}
                                    <a href="{{ url_for('show_property', prop='has'+prop, value=label) }}">{{ label }}</a>
                                {% elif 'Has'+prop in properties and properties!=[] %}
                                    <a href="{{ url_for('show_property', prop='Has'+prop, value=label) }}">{{ label }}</a>
                                {% else %}
                                    <a href="{{ url_for('show_deity', name=label) }}">{{ label }}</a>
                                {% endif %}
                            {% endif %}
                        {% elif is_link == "module" %}
                            <ul>
                            {% for subkey, (subvalue, is_uri) in label.items() %}
                                <li><strong>{{ subkey }}:</strong>
                                {% if is_uri %}
                                    {% if prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    
                                    {% elif subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>

                                    
                                    {% else %}
                                        <a href="{{ url_for('show_deity', name=subvalue) }}">{{ subvalue }}</a>
                                    {% endif %}
                                {% else %}
                                    {% if prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+prop in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop=subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% elif 'Has'+subkey in properties and properties!=[] %}
                                            <a href="{{ url_for('show_property', prop='Has'+subkey, value=subvalue) }}">{{ subvalue }}</a>
                                    {% else %}
                                        {{ subvalue }}
                                    {% endif %}
                                {% endif %}
                                </li>
                            {% endfor %}
                            </ul>

                        {% else %}
                            {% if '.png' in label or '.jpg' in label or '.jpeg' in label or '.gif' in label or '.svg' in label  %}
                                        <div class="image-container">
                                            <img src={{ url_for('static', filename='images/ontology/' ~ label) }} alt="Image">
                                        </div>
                            {% elif '/owl#NamedIndividual' not in label and '/owl#Class' not in label %}
                                {{ label }}
                            {% else %}
                                {% if '/owl#Class' not in label %}
                                    {{ label.split("#")[-1] }}
                                {% endif %}    
                            {% endif %}
                        {% endif %}
                    </div>
                {% endfor %}
                {% if values|length > 3 %}
                    <button class="btn" onclick="showMore(this)">‚Äì see more ‚Äì</button>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}

    <!-- Story Card -->
    {% if 'Story' in data %}
            <div class="card" style="--delay: {{ delay }}s;">
                <h3>Story</h3>
                {% for item in data["Story"] %}
                {% set triple, is_link = item %}
                {% if triple | length == 3 %}
                    {% set story_uri, story_title, story_abstract = triple %}
                    <div class="story-card {% if loop.index > 1 %}hidden{% endif %}">
                        <strong>{{ story_title }}</strong>
                        <a href="{{ url_for('show_deity', name=story_uri) }}">- LINK -</a>
                        {% for paragraph in story_abstract.split('.') %}
                            {% if paragraph.strip() %}
                                <p><em>{{ paragraph.strip() }}.</em></p>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
                {% endfor %}
                {% if data["Story"]|length > 1 %}
                    <button onclick="showMore(this)">‚Äì see more ‚Äì</button>
                {% endif %}
            </div>
        {% endif %}

</div>


    <br>
    <a href="{{ url_for('home') }}">Back to Home</a>

    <script>
    /*function toggleCard(button) {
        const card = button.closest('.card');
        const items = card.querySelectorAll('.card > div, .story-card');

        const isExpanded = button.getAttribute('data-expanded') !== 'false';

        if (isExpanded) {
            items.forEach(item => {
                item.style.maxHeight = null;
                item.classList.add('hidden');
            });
            button.textContent = '‚Äì show ‚Äì';
            button.setAttribute('data-expanded', 'false');
        } else {
            items.forEach(item => {
                item.classList.remove('hidden');
                item.style.maxHeight = item.scrollHeight + "px";
            });
            button.textContent = '‚Äì hide ‚Äì';
            button.setAttribute('data-expanded', 'true');
        }
    }*/

    function toggleCard(button) {
        const card = button.closest('.card');
        card.style.display = "none";
    }
    </script>

    <script>
    function showAllCards() {
        document.querySelectorAll('.card').forEach(card => {
            card.style.display = "block";
        });
    }
    </script>



    <script>
        function autocompleteSearch(val) {
            const box = document.getElementById("autocomplete-box");
            box.innerHTML = "";

            if (val.length < 2) return;

            fetch(`/autocomplete?q=${val}`)
                .then(res => res.json())
                .then(data => {
                    data.forEach(item => {
                        const div = document.createElement("div");
                        div.textContent = item;
                        div.onclick = function () {
                            document.getElementById("search-input").value = item;
                            box.innerHTML = "";
                        };
                        box.appendChild(div);
                    });
                });
        }

        function showMore(button) {
            const list = button.closest('.card, ul');
            const hiddenItems = list.querySelectorAll('.hidden');
            hiddenItems.forEach(item => {
                item.style.maxHeight = item.scrollHeight + "px";
                item.classList.remove('hidden');
            });
            button.style.display = 'none';
        }
    
        document.addEventListener("DOMContentLoaded", function () {
            const favorites = JSON.parse(localStorage.getItem("favorites") || "{}");
        
            function updateStars() {
                document.querySelectorAll(".star-btn").forEach(btn => {
                    const type = btn.dataset.type;
                    const name = btn.dataset.name;
                    const isFav = favorites[type]?.includes(name);
                    btn.textContent = isFav ? "‚òÖ" : "‚òÜ";
                });
            }
        
            document.querySelectorAll(".star-btn").forEach(btn => {
                btn.addEventListener("click", () => {
                    const type = btn.dataset.type;
                    const name = btn.dataset.name;
        
                    if (!favorites[type]) favorites[type] = [];
        
                    const index = favorites[type].indexOf(name);
                    if (index > -1) {
                        favorites[type].splice(index, 1);
                    } else {
                        favorites[type].push(name);
                    }
        
                    localStorage.setItem("favorites", JSON.stringify(favorites));
                    updateStars();
                });
            });
        
            updateStars();
        });
        </script>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('theme-toggle');
    const body = document.body;

    // Load saved theme
    if (localStorage.getItem('theme') === 'dark') {
        body.classList.add('dark-mode');
        toggleButton.textContent = "‚òÄÔ∏è";
    }

    toggleButton.addEventListener('click', function () {
        body.classList.toggle('dark-mode');

        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark');
            toggleButton.textContent = "‚òÄÔ∏è";
        } else {
            localStorage.setItem('theme', 'light');
            toggleButton.textContent = "üåô";
        }
    });
});
</script>

</body>
</html>
